{% extends "base.html" %}

{% block container %}
  <div class="row justify-content-center">
    <div class="col-11 col-lg-10">
      {% if current_user.is_admin %}
        <div class="mb-3">
          <button id="add-date" class="btn d-inline-block mt-0 me-2">+ Add date</button>
          <a href="{{ url_for('students') }}" class="btn sec me-2 mt-0">Students</a>
          <a href="{{ url_for('tutors') }}" class="btn sec mt-0">Tutors</a>
        </div>

        <form id="add-date-form" class="hidden-form" action="" method="post">
          <h1 class="mb-3 me-2 d-inline-block">Add test date</h1>
          <a id="hide-form" href="#">Hide</a>

          <div class="row mb-4">
            <div class="col col-md-6">
              {{ form.hidden_tag() }}
              <div class="mb-2">
                {{ form.test(class='d-inline-block') }}
                {{ form.status(class='d-inline-block') }}
              </div>
              <label for="date">Test date:</label>{{ form.date(class='mb-2') }}
              <label for="reg_date">Registration deadline:</label>{{ form.reg_date(class='mb-2') }}
              <label for="late_date">Late deadline:</label>{{ form.late_date(class='mb-2') }}
              <label for="other_date">Other deadline:</label>{{ form.other_date(class='mb-2') }}
              <label for="other_date">Score release date:</label>{{ form.score_date }}
              {{ form.submit }}
            </div>
          </div>
        </form>
      {% else %}
        <p>
          In addition to the weekend dates listed below, schools and districts may offer the
          SAT or ACT on a school day. Schools handle student registration for these dates, so
          please contact your school to learn more. 
        </p>
      {% endif %}

      {% for t in tests %}
        <h1>{{ t[0].upper() }} dates</h1>
        
        <div class="table-container mb-4">
          <table class="table m-0">
            <thead>
              <tr>
                <th>Test date</th>
                <th>Registration deadline</th>
                <th>Late deadline</th>
                <th>Score release date</th>
              </tr>
            </thead>
            <tbody>
              {% for d in upcoming_weekend_dates %}
                {% if d.test == t[0] %}
                  <tr>
                    <td>
                      {% if current_user.is_admin %}
                        <a href="{{ url_for('edit_date', id=d.id) }}">
                      {% endif %}
                      {{ d.date.strftime('%B %-d, %Y') }}</a>
                      {% if d.status == 'unconfirmed' %}
                        (unconfirmed)
                      {% endif %}
                    </td>
                    <td>
                      {{ d.reg_date.strftime('%B %-d') }}
                    </td>
                    <td>
                      {{ d.late_date.strftime('%B %-d') }}
                    </td>
                    <td>
                      {% if d.score_date != None %}
                        {{ d.score_date.strftime('%B %-d') }}
                      {% endif %}
                    </td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endfor %}
                
      {% if current_user.is_admin %}
        {% for s in ['school', 'past'] %}
          <h1 class="mt-3 mb-2">{{ s.title() }} tests</h1>
          {% for d in other_dates %}
            {% if d.status == s %}
              <div class="row justify-content-centered">
                <div class="col-9 col-md-10">
                  <h2 class="my-1">
                    <a href="{{ url_for('edit_date', id=d.id) }}">
                      {{ d.test.upper() }} on {{ d.date.strftime('%B %-d, %Y') }}
                    </a>
                  </h2>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% else %}
        <div class="text-center">
          <a href="{{ url_for('test_reminders') }}" class="btn highlight mt-1 d-block w-fit">Get reminders for selected test dates</a>
          <a href="{{ url_for('index') }}" class="btn sec sm">Learn more about Open Path test prep</a>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock container %}

{% block end_scripts %}
  <script>
    const slideDown = element => element.style.height = `${element.scrollHeight}px`;
    const slideUp = element => element.style.height = '0px';

    document.getElementById("add-date").addEventListener("click", function () {
      this.parentElement.style.display = "none";
      slideDown(document.getElementById("add-date-form"));
    });

    document.getElementById("hide-form").addEventListener("click", function () {
      slideUp(this.parentElement);
      document.getElementById("add-date").parentElement.style.display = "block";
    });
  </script>
{% endblock end_scripts %}
